# Public API
The main entry to the simulator is the function [`run_battery`](@ref). 

This function takes an input object which can be generated by a json file using the function
[`readBattMoJsonInputFile`](@ref). We also provide to the possibility to run a simulation from a model setup using
Matlab.

Therefore, a description of the API at the public level consists of the description of the json input file format.

In this [directory](https://github.com/BattMoTeam/BattMo.jl/blob/main/test/data/jsonfiles/), we have collected json
input files.

The reference for all json input is given through [JSON schema](https://json-schema.org/). The schemas are published in
only one place, in this [directory](https://github.com/BattMoTeam/BattMo/blob/main/Utilities/JsonSchemas/), which is in
the Matlab version of BattMo. In this way, we avoid to duplicate them as we are targeting full compatibility between the
two codes. Note that all functionalities are not yet supported in the julia version, in particular not all the
geometries. For that reason, we recommend to look at the directory of the json input files mentioned above, where all
the files are compatible with the julia version.


## Simulation Parameters

The simulation parameters belong to one of the following categories. Each of the category is explicated below and shown in a hierarchical graph.

- **Model specifications** : This category of parameters describes the model choices. For example, presence or not of current collectors, use of SEI model.
- **Battery physical parameters** : This category contains all the physical parameters that belong to the P2D model.
- **Control** : This category contains the parameters describing the control or stimulation that is used (for example CCCV)
- **Geometry** : This category contains the geometrical parameters. At the moment, we cover a julia only a small subset of all the presented parameters here.
- **State initialisation** : This category contains the parameters related to the initialisation of the state in the battery at intial time,
- **Time stepping** : This category contains settings about the time stepping
- **Output** : This category contains the desired content of the output.
- **Solver** : This category contains setup for the solver that is used for the simulation

For many of the parameters, except the physical parameters, default values are provided.

::: details Simulation JSON schema {close}
```json
{
  "$id": "file://./Simulation.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Input description for a Battery simulation in BattMo",
  "type": "object",
  "allOf": [
    {
      "$ref": "ModelSpecification.schema.json",
      "description": "Overall model specification. Choice of physics and component that will be included in the model"
    },
    {
      "$ref": "Battery.schema.json",
      "description": "Battery Physical Parameters"
    },
    {
      "$ref": "ControlModel.schema.json",
      "description": "Input for the control type and the corresponding parameters"
    },
    {
      "$ref": "Geometry.schema.json",
      "description": "Specification of the geometry including the discretization parameters"
    },
    {
      "$ref": "StateInitialization.schema.json",
      "description": "Input to setup the initial state of the battery"
    },
    {
      "$ref": "TimeStepping.schema.json",
      "description": "Input for the time stepping"
    },
    {
      "$ref": "Solver.schema.json",
      "description": "Options for the solver"
    },
    {
      "$ref": "Output.schema.json",
      "description": "Input for the choice of outputs the will be returned"
    }
  ]
}
```
:::

## Physical parameters

### Battery level

At the battery level, we have the following components:
- A positive and negative **electrode**
- An **electrolyte**
- A **control** model
- A **separator**
- A **thermal** model

Each of these models are given parameters that we review below

````@raw html
    <img src = "../../assets/cutbatterygraph.png" style = "width:100%;display:block;margin-left:auto;margin-right:auto;margin-top:1cm;margin-bottom:1cm">
````

::: details Battery example (selected keywords) {open}
```json
{
  "NegativeElectrode": { ... },
  "PositiveElectrode": { ... },
  "Separator": { ... },
  "Electrolyte": { ... },
  "SOC": 1.0,
  "initT": 298.15,
  "use_thermal": true,
  "include_current_collectors": false,
  "Control": { ... },
  "ThermalModel": { ... },
  ...
}
```
:::

::: details Battery JSON schema {close}
```json
{
  "$id": "file://./Battery.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "A standard battery",
  "type": "object",
  "properties": {
    "NegativeElectrode": {
      "$ref": "Electrode.schema.json"
    },
    "PositiveElectrode": {
      "$ref": "Electrode.schema.json"
    },
    "Electrolyte": {
      "$ref": "Electrolyte.schema.json"
    },
    "Separator": {
      "$ref": "Separator.schema.json"
    },
    "ThermalModel": {
      "$ref": "ThermalComponent.schema.json",
      "description": "Battery Physical Parameters required for thermal modelling"
    }
  },
  "allOf": [
    {
      "required": [
        "NegativeElectrode",
        "PositiveElectrode",
        "Electrolyte",
        "Separator"
      ]
    }
  ]
}
```
:::

### Electrode level

At the Electrode level we have the following components
- A coating
- A current collector

Both components share a common set of parameters a an electronic component, in particular the electronic conductivity

````@raw html
<img src = "../../assets/electrodegraph.png" style = "width:50%;display:block;margin-left:auto;margin-right:auto;margin-top:1cm;margin-bottom:1cm">
````

::: details Electrode example (selected keywords) {open}
```json
{"NegativeElectrode": {
     "Coating": {...},
     "CurrentCollector": {...}
  }
```
:::

::: details Electrode JSON schema {close}
```json
{
  "$id": "file://./Electrode.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Electrode",
  "type": "object",
  "properties" : {
    "Coating" : {"$ref" : "Coating.schema.json"},
    "CurrentCollector" : {"$ref" : "CurrentCollector.schema.json"}
  }
}
```
:::

### Coating level

At the coating level, we have the following components
- An active material
- A binder
- A conductive additive

The mass fractions of the components and the effective density of the coating is used to compute the porosity. The
intrinsic electronic conductivity of each of the components, with the Bruggeman coefficient and the porosity, is used to
compute an effective electronic conductivity in the coating.

````@raw html
    <img src = "../../assets/coatinggraph.png" style = "width:70%;display:block;margin-left:auto;margin-right:auto;margin-top:1cm;margin-bottom:1cm">
````

::: details Coating example (part of) {open}
```json
{"Coating": {
    "effectiveDensity": 1900,
    "bruggemanCoefficient": 1.5,
    "ActiveMaterial": {
           "massFraction": 0.9,
           "density": 2260.0,
           ...},
    "Binder": {
           "density": 1780.0,
           "massFraction": 0.05,
           ...
        },
    "ConductingAdditive": {
    "density": 1800.0,
    "massFraction": 0.05,
    ...
    }
```
:::

::: details Coating JSON schema {close}
```json
{
  "$id": "file://./Coating.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Coating",
  "type": "object",
  "allOf": [
    {
      "$ref": "./ElectronicComponent.schema.json"
    },
    {
      "properties": {
        "activeMaterialModelSetup": {
          "type" : "object",
          "properties" : {
            "composite" : {"type" : "boolean",
                           "description" : "default is false. It true, setup a composite material with two active materials, using fields ActiveMaterial1 and ActiveMaterial2"},
            "SEImodel" : {"type" : "string",
                          "enum" : ["none", "Safari", "Bolay"]}}},
        "ActiveMaterial": {
          "$ref": "ActiveMaterial.schema.json"
        },
        "ActiveMaterial1": {
          "$ref": "ActiveMaterial.schema.json"
        },
        "ActiveMaterial2": {
          "$ref": "ActiveMaterial.schema.json"
        },
        "Binder": {
          "$ref": "Binder.schema.json"
        },
        "ConductingAdditive": {
          "$ref": "ConductingAdditive.schema.json"
        },
        "effectiveDensity": {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the mass density of the material (either in wet or calendared state). The density is computed with respect to the total volume (i.e. including the empty pores)",
          "symbol": "rho"
        },
        "bruggemanCoefficient": {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the Bruggeman coefficient for effective transport in porous media",
          "symbol": "beta"
        },
        "volumeFraction" : {
          "type": "number",
          "description": "Volume fraction of the coating. This value is, in the default setup, computed from the other parameters (the mass fractions and the densities of the components, and the effictive density). If the value is passed here using this property, it overrides the default setup.",
          "symbol": "vf"
        },
        "volumeFractions" : {
          "type" : "array",
          "items" : {"type" : "number"},
          "minItems": 3,
          "maxItems": 3,
          "description": "Volume fractions for each of the component (active material, binder, conducting additive). As the volume fraction, this value , in the default setup, computed from the other parameters (the mass fractions and the densities of the components, and the effictive density). If the value is passed here using this property, it overrides the default setup. If none of the specific volumes of the components can be computed, then we assume that the volume fraction of the active material is equal to one."
        },
        "effectiveVolumetricHeatCapacity" : {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the effective volumetric heat capacity, which take into account the volume fraction. This value is in the default setup computed, but the value given here will overwrite the default computed value."
        },
        "effectiveThermalConductivity" : {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the effective thermal conductivity, which take into account the volume fraction and the bruggeman coefficient. This value is in the default setup computed, but the value given here will overwrite the default computed value."
        }
      }
    },
    {
      "if": {
        "properties": {
          "active_material_type": {
            "enum": ["default"]
          }
        },
        "required": ["active_material_type"]
      },
      "then": {
        "required": [
          "ActiveMaterial"
        ]
      }
    },
    {
      "if": {
        "properties": {
          "active_material_type": {
            "enum": ["composite"]
          }
        },
        "required": ["active_material_type"]
      },
      "then": {
        "required": [
          "ActiveMaterial1",
          "ActiveMaterial2"
        ]
      }
    }

  ]
}

```
:::

### Active Material level

At the active material level we have the following components
- An interface, where the parameters related to the interface reactions are given
- A solid diffusion model, where the parameters related to the solid diffusion are given

````@raw html
    <img src = "../../assets/activematerialgraph.png" style = "width:50%;display:block;margin-left:auto;margin-right:auto;margin-top:1cm;margin-bottom:1cm">
````

::: details Active material example (selected keywords) {open}
```json
{ "ActiveMaterial": {
    "electronicConductivity": 100.0,
    "Interface": {...},
    "SolidDiffusion": {...},
    ...
    }
}
```
:::


::: details ActiveMaterial JSON schema {close}
```json
{
  "$id": "file://./ActiveMaterial.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "Active Material",
  "type": "object",
  "properties": {
    "SEImodel" : {"type" : "string",
                  "enum" : ["none", "Safari", "Bolay"],
                  "description" : "The default is \"standard\" with no SEI layer model. Two SEI models are implemented Safari (2009) and Bolay et al (2022)"},
    "Interface": {
      "$ref": "Interface.schema.json"
    },
    "diffusionModelType": {
      "type": "string",
      "enum": [
        "full",
        "simple"
      ]
    },
    "electronicConductivity": {
      "$ref": "PhysicalQuantity.schema.json",
      "properties": {
        "rdf_type": {
          "const": "htttp://emmo.info/UUID"
        }
      },
      "description": "the electronic conductivity of the material",
      "symbol": "sigma"
    },
    "density": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the mass density of the material",
      "symbol": "rho"
    },
    "massFraction": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the ratio of the mass of the material to the total mass of the phase or mixture",
      "symbol": "gamma"
    },
    "thermalConductivity": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the intrinsic Thermal conductivity of the active component",
      "symbol": ""
    },
    "specificHeatCapacity": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the Specific Heat capacity of the active component",
      "symbol": ""
    }
  },
  "required": [
    "Interface",
    "SolidDiffusion"
  ],
  "anyOf": [
    {
      "if": {
        "properties": {
          "diffusionModelType": {
            "const": "full"
          }
        }
      },
      "then": {
        "properties": {
          "SolidDiffusion": {
            "$ref": "FullSolidDiffusionModel.schema.json"
          }
        }
      },
      "else": {
        "properties": {
          "SolidDiffusion": {
            "$ref": "SimplifiedSolidDiffusionModel.schema.json"
          }
        }
      }
    }
  ]
}
```
:::

### Inteface level

At the interface level, we have the parameters that enter the interface reaction. 

::: details Interface example (selected keywords) {open}
```json
{           
"Interface": {
    "saturationConcentration": 29583.0,
    "volumetricSurfaceArea": 383959.0,
    "density": 2260.0,
    "numberOfElectronsTransferred": 1,
    "activationEnergyOfReaction": 35000.0,
    "reactionRateConstant": 6.716e-12,
    "guestStoichiometry100": 0.9014,
    "guestStoichiometry0": 0.0279,
    "chargeTransferCoefficient": 0.5,
    "openCircuitPotential": {
    "type": "function",
    "functionname": "computeOCP_Graphite_SiOx_Chen2020",
        "argumentlist": ["c",
                         "cmax"
                 ]
              }
           }
}
```
:::

We notice here that we have a functional parameters. We have a format for such input which are neither a scalar or a
vector. In the case above, the function that is called is implemented directly in BattMo with the name indicated. We
support also string expressions that are parsed and evaluated,

::: details Interface 2 example (selected keywords) {open}
```json
{ 
"Interface": {
   "openCircuitPotential": {
     "type": "function",
     "function": "0.7222+ 0.1387*(c./cmax) + 0.0290*(c./cmax)^0.5 - 0.0172/(c./cmax) + 0.0019/(c./cmax)^1.5+ 0.2808 * exp(0.9 - 15.0*(c./cmax)) - 0.7984 * exp(0.4465*(c./cmax) - 0.4108)+ (T - refT) * (1e-3 * ( 0.005269056+ 3.299265709 * (c./cmax)- 91.79325798 * (c./cmax)^2+ 1004.911008 * (c./cmax)^3- 5812.278127 * (c./cmax)^4+ 19329.75490 * (c./cmax)*5- 37147.89470 * (c./cmax)*6+ 38379.18127 * (c./cmax)*7- 16515.05308 * (c./cmax)*8 )/ ( 1- 48.09287227 * (c./cmax)+ 1017.234804 * (c./cmax)^2- 10481.80419 * (c./cmax)^3+ 59431.30000 * (c./cmax)^4- 195881.6488 * (c./cmax)*5+ 374577.3152 * (c./cmax)*6- 385821.1607 * (c./cmax)*7+ 165705.8597 * (c./cmax)*8 ))",
     "argumentlist": [
       "concentration",
       "temperature",
       "cmax"
     ]
   }
  }
}
```
:::

and tabulated data, as a function of the stoichiometry `theta`,

::: details Interface 3 example (selected keywords) {open}
```json
{
"Interface": {
      "openCircuitPotential": {
          "type": "function",
          "data_x": [0.031296231, 0.034999017, 0.038701797999999996, 0.042404576, 0.046107357, 0.049810147, 0.053512917, 0.05721568, 0.06091845, 0.064621218, 0.06832399, 0.072026752, 0.075729512, 0.079432272, 0.083135031, 0.086837786, 0.090540544, 0.094243312, 0.09794607, 0.101648825, 0.105351579, 0.109054336, 0.11275709699999999, 0.116459849, 0.120162608, 0.123865357, 0.12756811199999998, 0.13127086400000001, 0.134973621, 0.13867638300000001, 0.14237913, 0.14608189, 0.14978465, 0.153487405, 0.157190176, 0.160892939, 0.16459570099999998, 0.16829847, 0.17200122399999998, 0.175703988, 0.17940673899999998, 0.183109501, 0.18681228600000002, 0.190515044, 0.194217798, 0.19792056100000002, 0.201623338, 0.20532609999999998, 0.209028863, 0.212731638, 0.2164344, 0.220137159, 0.22383993300000002, 0.227542705, 0.231245473, 0.234948247, 0.238651007, 0.24235377100000002, 0.246056535, 0.24975929600000002, 0.253462075, 0.257164856, 0.260867623, 0.264570388, 0.268273142, 0.27197589899999997, 0.27567867100000004, 0.279381438, 0.283084209, 0.28678698399999997, 0.290489741, 0.294192511, 0.297895288, 0.301598064, 0.30530083, 0.30900360600000004, 0.312706366, 0.316409129, 0.320111892, 0.32381465800000003, 0.32751744, 0.331220205, 0.334922968, 0.33862575100000003, 0.34232852799999997, 0.34603131, 0.349734084, 0.353436855, 0.357139628, 0.36084241200000006, 0.364545175, 0.368247948, 0.371950715, 0.37565348200000004, 0.37935626, 0.383059045, 0.38676182, 0.390464597, 0.39416737399999996, 0.397870147, 0.40157291100000003, 0.405275674, 0.408978444, 0.412681205, 0.41638398200000004, 0.42008676100000003, 0.42378952799999997, 0.427492296, 0.431195061, 0.434897837, 0.43860061100000003, 0.442303382, 0.446006148, 0.449708926, 0.453411684, 0.45711444100000004, 0.46081719299999996, 0.464519943, 0.468222694, 0.471925449, 0.475628215, 0.479330982, 0.483033747, 0.48673651100000004, 0.49043926299999996, 0.494142033, 0.49784481700000005, 0.501547588, 0.505250356, 0.508953106, 0.512655855, 0.516358615, 0.5200613860000001, 0.523764154, 0.527466922, 0.531169691, 0.534872451, 0.5385752070000001, 0.542277974, 0.54598074, 0.549683501, 0.55338627, 0.55708902, 0.560791784, 0.5644945370000001, 0.5681972989999999, 0.571900057, 0.575602818, 0.579305582, 0.583008351, 0.586711119, 0.590413886, 0.594116642, 0.597819412, 0.6015221820000001, 0.605224955, 0.608927724, 0.6126304779999999, 0.61633325, 0.620036027, 0.623738798, 0.627441562, 0.631144326, 0.634847115, 0.638549884, 0.6422526510000001, 0.64595543, 0.6496582320000001, 0.653361005, 0.657063775, 0.660766564, 0.6644693389999999, 0.668172119, 0.671874891, 0.67557767, 0.679280441, 0.68298322, 0.6866860020000001, 0.6903887790000001, 0.694091555, 0.697794325, 0.701497094, 0.705199875, 0.7089026390000001, 0.712605404, 0.716308185, 0.720010954, 0.7237137109999999, 0.727416484, 0.731119252, 0.734822036, 0.7385248000000001, 0.742227568, 0.74593034, 0.7496331190000001, 0.7533358920000001, 0.757038685, 0.76074146, 0.764444224, 0.768146984, 0.77184976, 0.7755525329999999, 0.779255308, 0.782958073, 0.786660853, 0.7903636390000001, 0.7940664070000001, 0.7977691809999999, 0.801471972, 0.80517474, 0.808877513, 0.812580278, 0.816283043, 0.819985807, 0.8236885820000001, 0.8273913629999999, 0.831094112, 0.834796875, 0.838499654, 0.842202418, 0.845905185, 0.849607966, 0.8533107459999999, 0.857013527, 0.8607163090000001, 0.8644190740000001, 0.868121861, 0.871824645, 0.875527416, 0.8792301929999999, 0.8829329579999999, 0.886635728, 0.8903384940000001, 0.894041256, 0.897744037, 0.901446801],
          "data_y": [1.0828806999999998, 0.99593794, 0.90023398, 0.79649431, 0.73354429, 0.66664314, 0.64137149, 0.59813869, 0.5670835999999999, 0.54746181, 0.53068399, 0.51304734, 0.49394092, 0.47926274, 0.46065259, 0.45992726, 0.43801501, 0.42438665, 0.41150269, 0.40033659, 0.38957134, 0.37756538, 0.36292541, 0.34357086, 0.34063140000000003, 0.32299468, 0.31379458, 0.30795386, 0.29207319, 0.28697687, 0.27405477, 0.26704970000000006, 0.25857493, 0.25265783, 0.24826777, 0.24143449999999997, 0.23362778, 0.22956218, 0.22370236, 0.22181271, 0.22089651, 0.2194268, 0.21830064, 0.21830064, 0.21753715, 0.21719357, 0.21635373, 0.21635373, 0.21635373, 0.21469313, 0.21469313, 0.21465495, 0.21354789999999998, 0.21354789999999998, 0.21074206, 0.20873788, 0.20465319, 0.20205732, 0.19774358, 0.19444147, 0.19190285, 0.18850531, 0.18581399, 0.18327537, 0.18157659, 0.17814088, 0.17529686, 0.1719375, 0.16934161, 0.16756649, 0.16609676, 0.16414985, 0.16260378, 0.16224113, 0.160027, 0.15827096, 0.15827096, 0.15552238, 0.15552238, 0.15220118, 0.1511132, 0.14987253, 0.14874637, 0.14678037, 0.14620776, 0.14555879, 0.14389819, 0.14359279, 0.14242846, 0.14038612, 0.13882096, 0.13882096, 0.13882096, 0.13780934, 0.13780934, 0.13698858, 0.13523254, 0.13441178, 0.13441178, 0.13441178, 0.13441178, 0.13441178, 0.13435452, 0.1334765, 0.1334765, 0.13275118, 0.13275118, 0.13263667, 0.13263667, 0.13263667, 0.13263667, 0.13263667, 0.13263667, 0.13263667, 0.13259849, 0.13259849, 0.13259849, 0.13259849, 0.13259849, 0.13259849, 0.13259849, 0.13259849, 0.13259849, 0.13225491, 0.13225491, 0.13225491, 0.13187316, 0.13187316, 0.13187316, 0.13187316, 0.13187316, 0.13187316, 0.13187316, 0.13187316, 0.13187316, 0.13145325, 0.13145325, 0.13145325, 0.1313578, 0.1313578, 0.13120511, 0.13089971, 0.13089971, 0.13082336, 0.13011713, 0.129869, 0.129869, 0.12942998, 0.12796026, 0.12796026, 0.12656689, 0.12656689, 0.12509716, 0.12110791, 0.11839751, 0.11244226, 0.11244226, 0.1092165, 0.10683058, 0.10433014, 0.10433014, 0.10056993, 0.099501044, 0.098546676, 0.098546676, 0.095416352, 0.095416352, 0.095416352, 0.095416352, 0.095416352, 0.095416352, 0.094309285, 0.094309285, 0.09366031699999999, 0.09366031699999999, 0.09366031699999999, 0.09316404199999999, 0.09316404199999999, 0.093087696, 0.093087696, 0.093087696, 0.093087696, 0.093087696, 0.092915908, 0.092915908, 0.092629597, 0.092629597, 0.09261051599999999, 0.092495985, 0.092400551, 0.092400551, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.09209515199999999, 0.091656148, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091598883, 0.091503449, 0.091503449, 0.091503449, 0.091503449, 0.091312572, 0.091178961, 0.091178961, 0.09089265, 0.090587251, 0.090510905, 0.090339117, 0.090339117, 0.090339117, 0.08946110300000001, 0.08946110300000001, 0.089212969, 0.088812128, 0.087972291, 0.08709427, 0.085032836],
     "argumentlist": [
         "theta"
         ]
     }
   },
   ...
}
```
:::

::: details Interface JSON schema {close}
```json
{

  "$id": "file://./Interface.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "interface",
  "type": "object",
  "properties": {
    "saturationConcentration": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the saturation concentration of the guest molecule in the host material",
      "symbol": "cmax"
    },
    "numberOfElectronsTransferred": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "stoichiometric number of electrons transferred in the electrochemical reaction",
      "symbol": "n"
    },
    "volumetricSurfaceArea": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "surface area of the active material - electrolyte interface per volume of electrode"
    },
    "activationEnergyOfReaction": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the activation energy of the electrochemical reaction",
      "symbol": "Eak"
    },
    "reactionRateConstant": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the reaction rate constant of the electrochemical reaction",
      "symbol": "k0"
    },
    "exchangeCurrentDensity": {
      "allOf": [
        {"$ref": "Function.schema.json"},
        { "properties" : {
          "argumentlist": {"type" : "array",
                           "prefixItems": [{"const": "soc"}]
                          },
          "symbol": {"const" : "j0"}}}
        ],
      "description": "The exchange current at the electrode-electrolyte interface under equilibrium conditions. If not given, it is computed from the reaction rate constant"
    },
    "guestStoichiometry100": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the ratio of the concentration of the guest molecule to the saturation concentration of the guest molecule in a phase at a cell voltage that is defined as 100% SOC",
      "symbol": "theta100"
    },
    "guestStoichiometry0": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the ratio of the concentration of the guest molecule to the saturation concentration of the guest molecule in a phase at a cell voltage that is defined as 0% SOC",
      "symbol": "theta0"
    },
    "density": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the mass density of the active material",
      "symbol": "rho"
    },
    "openCircuitPotential": {
      "allOf": [
        {"$ref": "Function.schema.json"},
        { "properties" : {
          "argumentlist": {"type" : "array",
                           "prefixItems": [{"const": "concentration"},
                                           {"const": "temperature"},
                                           {"const": "cmax"}]
                          },
          "symbol": {"const" : "OCP"}}}
        ],
      "description": "a function to determine the open-circuit potential of the electrode under given conditions"
    },
    "chargeTransferCoefficient": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the charge transfer coefficient that enters in the Butler-Volmer equation",
      "symbol": "alpha"
    }
  },
"allOf": [{
  "if": {
    "properties": {
      "exchangeCurrentDensity": {
        "properties": {
          "type": {
            "const": "constant"
          }
        },
        "required": ["exchangeCurrentDensity"]
      }
    }
  },
  "then": {
    "required": [
      "reactionRateConstant"
    ]
  }
}]
}
```
:::

### Solid diffusion level

At the solid diffusion level, we find the parameters related to the solid diffusion in the particle

::: details Solid Diffusion example (selected keywords) {open}
```json
{           
"SolidDiffusion": {
  "activationEnergyOfDiffusion": 5000.0,
  "referenceDiffusionCoefficient": 3.9e-14,
  "particleRadius": 1e-06
  }
}
```
:::

::: details SolidDiffusionModel JSON schema {close}
```json
{
    "$id": "file://./SolidDiffusionModel.schema.json",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "description": "solid diffusion",
    "type": "object",
    "properties" : {
        "particleRadius": {
            "$ref": "PhysicalQuantity.schema.json",
            "description": "the characteristic radius of the particle",
            "symbol": "rp"
        },
        "activationEnergyOfDiffusion": {
            "$ref": "PhysicalQuantity.schema.json",
            "description": "the Arrhenius-type activation energy for diffusion",
            "symbol": "EaD"
        },
        "referenceDiffusionCoefficient": {
            "$ref": "PhysicalQuantity.schema.json",
            "description": "the pre-exponential reference diffusion coefficient in an Arrhenius-type equation",
            "symbol": "D0"
        },
        "volumetricSurfaceArea": {
            "$ref": "PhysicalQuantity.schema.json",
            "description": "surface area of the active material - electrolyte interface per volume of electrode"
        },
        "saturationConcentration": {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the saturation concentration of the guest molecule in the host material",
          "symbol": "cmax"
        },
        "guestStoichiometry100": {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the ratio of the concentration of the guest molecule to the saturation concentration of the guest molecule in a phase at a cell voltage that is defined as 100% SOC",
          "symbol": "theta100"
        },
        "guestStoichiometry0": {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "the ratio of the concentration of the guest molecule to the saturation concentration of the guest molecule in a phase at a cell voltage that is defined as 0% SOC",
          "symbol": "theta0"
        }      
    }
}
```
:::


### Electrolyte level

At the electrolyte level, we find the parameters for the electrolyte transport processes

::: details Electrolyte example (selected keywords) {open}
```json
{
  "Electrolyte": {
     "initialConcentration": 1000,
     "specificHeatCapacity": 1518.0,
     "ionicConductivity": {
        "type": "function",
        "functionname": "computeElectrolyteConductivity_Chen2020",
        "argumentlist": [
           "c"
        ]
     },
     "diffusionCoefficient": {
        "type": "function",
        "functionname": "computeDiffusionCoefficient_Chen2020",
        "argumentlist": [
           "c"
        ]
     },
     "compnames": [
        "Li",
        "PF6"
     ],
     "species": {
        "chargeNumber": 1,
        "transferenceNumber": 0.7406,
        "nominalConcentration": 1000
     },
     "bruggemanCoefficient": 1.5
  }
}
```
:::

Again, we observe two functional parameters

::: details Electrolyte JSON schema {close}
```json
{
  "$id": "file://./Electrolyte",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "description": "An electrolyte",
  "type": "object",
  "properties": {
    "ionicConductivity": {
      "allOf": [
        {"$ref": "Function.schema.json"},
        { "properties" : {
          "argumentlist": {"type" : "array",
                           "prefixItems": [{"const": "concentration"},
                                           {"const": "temperature"}]
                          },
          "symbol": {"const" : "kappa"}}}
        ],
      "description": "a function to determine the ionic conductivity of the electrolyte under given conditions"
    },
    "diffusionCoefficient": {
      "allOf": [
        {"$ref": "Function.schema.json"},
        { "properties" : {
          "argumentlist": {"type" : "array",
                           "prefixItems": [{"const": "concentration"},
                                           {"const": "temperature"}]
                          },
          "symbol": {"const" : "D"}}}
        ],
      "description": "a function to determine the diffusion coefficient of a molecule in the electrolyte under given conditions"
    },
    "species": {
      "type": "object",
      "description": "Property for the positive ion (Lithium). We support for the moment only binary electrolyte.",
      "properties": {
        "chargeNumber": {
          "type": "number",
          "description": "charge number"
        },
        "transferenceNumber": {
          "type": "number",
          "description": "transference number"
        },
        "nominalConcentration": {
          "$ref": "PhysicalQuantity.schema.json",
          "description": "nominal concentration used as initial concentration in a simulation, if the later is not given explicitely, see StateInitialization.schema.json"
        }}},
    "nominalEthyleneCarbonateConcentration" : {
      "$ref" : "PhysicalQuantity.schema.json",
      "description" : "Nominal Ethylene Carbonate concentration in the electrolyte. This is used as initial concentration, in case the SEI layer is included in model, see Coating.schema.json and the active_material_type property"},
    "density": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the mass density of the material",
      "symbol": "rho"
    },
    "bruggemanCoefficient": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the coefficient for determining effective transport parameters in porous media",
      "symbol": "beta"
    },
    "useRegionBruggemanCoefficients" : {
      "type" : "boolean",
      "description" : "Set to true if the electrolye region for each component should get a specific Bruggeman coefficient, as given by regionBruggemanCoefficients. Default value is false"},
    "regionBruggemanCoefficients" : {
      "type" : "object",
      "description" : "Bruggeman coefficients for each region",
      "NegativeElectrode" : {
        "$ref": "PhysicalQuantity.schema.json"},
      "PositiveElectrode" : {
        "$ref": "PhysicalQuantity.schema.json"},
      "Separator" : {
        "$ref": "PhysicalQuantity.schema.json"}},
    "regionTags" :  {"type" : "array",
                     "description" : "Numerical tags that identifies each grid cell for the electrolyte. The conventions is 1 for negative electrode, 2 for positive electrodes, 3 for separator. It is used only when useRegionBruggemanCoefficients is true. This property is typically setup by the grid constructor."},
    "thermalConductivity": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the intrinsic Thermal conductivity of the active component",
      "symbol": ""
    },
    "specificHeatCapacity": {
      "$ref": "PhysicalQuantity.schema.json",
      "description": "the Specific Heat capacity of the active component",
      "symbol": ""
    }
  }
}
```
:::

## Control parameters

We will release soon a general protocol specification. For the moment we support the following protocols
- CCCV
- Constant Current Discharge/Charge

::: details CCCV example (selected keywords) {open}
```json
{
  "Control": {
    "controlPolicy": "CCCV",
    "initialControl" : "discharging",
    "numberOfCycles" : 3,
    "CRate": 0.5,
    "DRate": 1.0,
    "lowerCutoffVoltage": 3.0,
    "upperCutoffVoltage": 4.0,
    "dIdtLimit": 1e-6,
    "dEdtLimit": 1e-4}
}
```
:::

::: details Discharge Control example (selected keywords) {open}
```json
{ 
"Control": {
    "controlPolicy": "CCDischarge",
    "DRate": 1,
    "lowerCutoffVoltage": 2.4,
    "upperCutoffVoltage": 4.1,
    "dIdtLimit": 0.01,
    "dEdtLimit": 0.01,
    "rampupTime": 10
  }
}
```
:::

::: details Control JSON schema {close}
```json
{
  "$id": "file://./ControlModel.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties" : {
    "Control" : {
      "type" : "object",
      "properties" : {
        "controlPolicy": {
          "type": "string",
          "enum": ["CCDischarge",
                   "CCCharge",
                   "CC",
                   "CCCV",
                   "powerControl",
		   "timeControl"]}}
    }},
    "allOf": [
      {"if": {
        "properties": {"controlPolicy" : {"const" : "CCDischarge"}},
        "then": {
          "$ref" : "#/$defs/CCDischarge"}}},
      {"if": {
        "properties": {"controlPolicy" : {"const" : "CCCharge"}},
        "then": {
          "$ref" : "#/$defs/CCCharge"}}},
      {"if": {
        "properties": {"controlPolicy" : {"const" : "CCCV"}},
        "then":{
          "$ref" : "#/$defs/CCCV"}}},
      {"if": {
        "properties": {"controlPolicy" : {"const" : "powerControl"}},
        "then": {
          "$ref" : "#/$defs/powerControl"}}}
    ],

  "$defs" : {
    "CCDischarge" : {
      "properties" : {
        "DRate" : {
          "type" : "number",
          "description" : "discharge rate"},
        "rampupTime" : {
          "type" : "number",
          "description" : "Rampup time where the current is increased linearly from zero to target value. In this way, we can avoid convergence issues in case of high current. Default value is zero, which means no rampup time"},
        "lowerCutoffVoltage" : {
          "type" : "number"},
        "useCVswitch" : {
          "type" : "boolean",
          "description" : "Switch to control voltage when the lower cutoff voltage is reached. Default value is false, which means that the simulation stops when the lower voltage is reached."
        }}},
    "CCCharge" : {
      "properties" : {
        "CRate" : {
          "type" : "number",
          "description" : "charge rate"},
        "rampupTime" : {
        "type" : "number",
        "description" : "Rampup time where the current is increased linearly from zero to target value. In this way, we can avoid convergence issues in case of high current."},
       "upperCutoffVoltage" : {
         "type" : "number"},
       "useCVswitch" : {
         "type" : "boolean",
         "description" : "Switch to control voltage when the upper cutoff voltage is reached. Default value is true."
       }
      }
    },
    "CCCV": {
      "properties" : {
        "CRate" : {
          "type" : "number",
          "description" : "charge rate"},
        "DRate" : {
          "type" : "number",
          "description" : "discharge rate"},
        "lowerCutoffVoltage" : {
          "type" : "number"},
        "upperCutoffVoltage" : {
	  "type" : "number"},
        "dEdtLimit" : {"type" : "number"},
        "dIdtLimit" : {"type" : "number"},
        "numberOfCycles" : {"type" : "number"},
        "initialControl" : {"type" : "string",
                            "enum" : ["discharging", "charging"]},
        "switchTolerances" : {
          "type" : "object",
          "description" : "tolerances for the computation of the control switching (relative tolerances)",
          "properties" : {
            "CC_discharge1" : { "type" : "number",
                                "description" : "control corresponding to constant current discharge until lower cutoff voltage is reached, default value : 1e-2"},
            "CC_discharge2" : { "type" : "number",
                                "description" :  "control corresponding to zero current until dEdtLimit is reached. Default value : 0.9"},
            "CC_charge1" : { "type" : "number",
                             "description" :  "control corresponding to constant current charge until upper cutoff voltage is reached. Default value : 1e-2"},
            "CV_charge2" : { "type" : "number",
                             "description" :  "control corresponding to constant voltage until dIdtLimit is reached. Default value : 0.9"}
          }
        }
      }},

    "powerControl": {
      "properties" : {
        "case" : {"type" : "string",
                  "enum" : ["time limited", "voltage limited", "CPCV"]},
        "dischargingPower" : {"type" : "number"},
        "chargingPower" : {"type" : "number"}},

      "anyOf" : [
        { "properties" : {
          "powerControlCase" : {"const" : "time limited"},
          "dischargingTime" : {"type" : "number"},
          "chargingTime" : {"type" : "number"}
        }},

        { "properties" : {
          "powerControlCase" : {"const" : "voltage limited"}
        }},

        { "properties" : {
          "powerControlCase" : {"const" : "CPCV"},
          "lowerCutoffPower" : {"type" : "number"},
          "upperCutoffPower" : {"type" : "number"}
        }
        }
      ]}
  }
}
```
:::

